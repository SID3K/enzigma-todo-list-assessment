<div class="header">
    <div style="display: flex;">    
        <span class="slds-icon_container slds-icon-standard-task" title="Task">
            <svg class="slds-icon slds-icon_medium icon" aria-hidden="true">
                <use xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#task"></use>
            </svg>
            <span class="slds-assistive-text">Task</span>
        </span>
        <h1 class="heading">Tasks</h1>
            
    </div>
    <div>
        <button
            class="slds-button slds-button_brand"
            (click)="openModal()">
            New Task
        </button>
        <button class="slds-button slds-button_neutral">Refresh</button>
    </div>
</div>
<p style="margin: 10px;">{{paginatedTasks.length}} records</p>
<table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_fixed-layout tbl" style="margin-bottom: 70px;">
  <thead>
    <tr class="slds-line-height_reset">
      <th scope="col">
        <div class="slds-truncate" title="Name">Assigned To</div>
      </th>
      <th scope="col">
        <div class="slds-truncate" title="Email">Status</div>
      </th>
      <th scope="col">
        <div class="slds-truncate" title="Role">Due Date</div>
      </th>
      <th scope="col">
        <div class="slds-truncate" title="Status">Priority</div>
      </th>
      <th scope="col">
        <div class="slds-truncate" title="Status">Comments</div>
      </th>
      <th scope="col">
        <div class="slds-truncate" title="Status"></div>
      </th>
    </tr>
  </thead>
 
  <tbody>
      @for(task of paginatedTasks; track task){
        <tr class="slds-hint-parent">
            
            <th scope="row" data-label="Name">
                <div class="slds-truncate" [title]="task.assignedTo">{{task.assignedTo}}</div>
            </th>
            <td data-label="Status">
                <div class="slds-truncate" [title]="task.status">{{task.status}}</div>
            </td>
            <td data-label="DueDate">
                <div class="slds-truncate" [title]="task.dueDate">{{task.dueDate}}</div>
            </td>
            <td data-label="Priority">
                <div class="slds-truncate" [title]="task.priority">{{task.priority}}</div>
            </td>
            <td data-label="Comments">
                <div class="slds-truncate" [title]="task.comments">{{task.comments}}</div>
            </td>
            <td>
                <button
                    class="slds-button slds-button_icon"
                    (click)="toggleMenu(task.id)">
                    <span class="slds-icon_container slds-icon-utility-down">
                        <svg class="slds-icon slds-icon_x-small icon-black" aria-hidden="true">
                            <use href="assets/icons/utility-sprite/svg/symbols.svg#down"></use>
                        </svg>
                    </span>
                </button>
                @if(activeMenuTaskId === task.id){
                    <div class="slds-dropdown">
                        <ul class="slds-dropdown__list">
                            <li class="slds-dropdown__item">
                                <a (click)="openEdit(task); closeMenu()">Edit</a>
                            </li>
                            <li class="slds-dropdown__item">
                                <a (click)="openDeleteModal(task); closeMenu()">Delete</a>
                            </li>
                        </ul>
                    </div>
                }

            </td>
        </tr>
        }
  </tbody>
</table>



<div class="slds-m-top_medium slds-grid slds-grid_align-spread slds-grid_vertical-align-center page">

  <div>
    Page {{ currentPage }} of {{ totalPages }}
  </div>

  <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center slds-m-top_medium">
  <div class="slds-grid slds-grid_vertical-align-center">
    <span class="slds-m-right_x-small">Page Size:</span>

    <div class="slds-select_container">
      <select
        class="slds-select"
        [ngModel]="pageSize"
        (ngModelChange)="changePageSize($event)">
        @for(size of pageSizes; track size;){
            <option [value]="size">
                {{ size }}
            </option>
        }
      </select>
    </div>
  </div>
</div>

  <div class="slds-button-group" role="group">

    <button
      class="slds-button slds-button_neutral"
      [disabled]="currentPage === 1"
      (click)="prevPage()">
      Previous
    </button>
    @for(page of [].constructor(totalPages); track page;){

        <button
            class="slds-button"
            [class.slds-button_brand]="currentPage === $index + 1"
            (click)="goToPage($index + 1)"
            style="margin: 0 8px; "
        >
            {{ $index + 1 }}
        </button>

    }
        <button
            class="slds-button slds-button_neutral"
            [disabled]="totalPages <= 1"
            (click)="nextPage()"
        >
            Next
        </button>

  </div>
</div>


@if(showModal){
<div>     
  <section
    role="dialog"
    tabindex="-1"
    class="slds-modal slds-fade-in-open">

    <div class="slds-modal__container">

      <header class="slds-modal__header">
        <button
          class="slds-button slds-button_icon slds-modal__close"
          (click)="closeModal()">
          ✕
        </button>
        <h2 class="slds-text-heading_medium">
          {{ modalTitle }}
        </h2>
      </header>

      <div class="slds-modal__content slds-p-around_medium">
        <app-task-form></app-task-form>
      </div>

      <footer class="slds-modal__footer">
        <button
          class="slds-button slds-button_brand"
          (click)="handleSave()">
          {{ saveButtonLabel }}
        </button>
        <button
          class="slds-button slds-button_neutral"
          (click)="closeModal()">
          Cancel
        </button>
      </footer>

    </div>
  </section>

  <div class="slds-backdrop slds-backdrop_open"></div>

</div>

}

@if(showDeleteModal){
<div>
  <section
    role="dialog"
    tabindex="-1"
    class="slds-modal slds-fade-in-open">

    <div class="slds-modal__container slds-modal_small">

      <header class="slds-modal__header">
        <button
          class="slds-button slds-button_icon slds-modal__close"
          (click)="closeDeleteModal()">
          ✕
        </button>
        <h2 class="slds-text-heading_medium">
          Delete Task
        </h2>
      </header>
      <div class="slds-modal__content slds-p-around_medium">
        <p>
          Are you sure you want to delete this task?
        </p>
      </div>
      <footer class="slds-modal__footer slds-grid slds-grid_align-end">
        <button
          class="slds-button slds-button_neutral slds-m-right_small"
          (click)="closeDeleteModal()">
          Cancel
        </button>
        <button
          class="slds-button slds-button_destructive"
          (click)="confirmDelete()">
          Delete
        </button>
      </footer>
    </div>
  </section>
  <div class="slds-backdrop slds-backdrop_open"></div>

</div>

}